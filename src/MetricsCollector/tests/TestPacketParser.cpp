#include <gtest/gtest.h>
#include "PacketParser.hpp"

using namespace MetricsCollector::PacketParser;

TEST(TestPacketParser, TestValidPacket)
{
	std::vector<uint8_t> testVec = { 0x01, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x39, 0x30, 0x00, 0x00, 0x18, 0x00, 0x00, 0x00, 0x4D };
	Message msg(testVec.data(), 40U);

	EXPECT_TRUE(msg.isValid(40U));
}

TEST(TestPacketParser, TestInvalidPacket)
{
	std::vector<uint8_t> testVec = { 0x01, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x39, 0x30, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0x4D };

	Message msg1(testVec.data(), 16U);

	EXPECT_FALSE(msg1.isValid(17U));

	// Changed ApplicationCode from 0x3930 to 0x3830
	testVec = { 0x01, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x38, 0x30, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0x4D };
	Message msg3(testVec.data(), 16U);

	EXPECT_FALSE(msg3.isValid(16U));
}
